pie(rep(1, 12), col = rgb((0:11)/11, green = 0, blue = 0, names = paste("red", 0:15, sep = ".")))
pie(rep(1, 12), col = rgb((0:11)/12, green = 0, blue = 0, names = paste("red", 0:15, sep = ".")))
?colors
pie(rep(1, 12), col = rgb((0:11)/12, green = 0, blue = 0, names = paste("red", 0:11, sep = ".")))
pie(rep(1, 12), col = rgb((0:11)/12, green = 0.5, blue = 0, names = paste("red", 0:11, sep = ".")))
pie(rep(1, 12), col = rgb((0:11)/12, green = 0.5, blue = 0.5, names = paste("red", 0:11, sep = ".")))
gray.colors
?gray.colors
pie(rep(1, 12), col = gray.colors(12))
?xtabs
?kable
?format
?xtabs
?subset
?format
ls()
setwd("~/Google 드라이브/Works/Class/Case_Studies_in_Stat/R.WD/Sejong/R")
load("./sejong_poll_kor.rda")
ls()
sejong.poll.kr
sejong.poll.kr.officers
rm(list = ls())
load("./sejong_poll_kor.RData")
ls()
data
rm(list = ls())
load("./sejong_poll_data.rda")
ls()
names(sejong.poll)
?col.names
?`[]
`
?`[
`
?kable
?xtabs
load("./sejong_poll_data.rda")
kable(sejong.poll[4:1])
library(knitr)
kable(sejong.poll[4:1])
sejong.poll.kr <- sejong.poll
sejong.poll.kr$vote <- factor(sejong.poll.kr$vote, levels = c("yes", "no"), labels = c("찬성", "반대"))
class.labels.kr <- c("대신 등", "수령",  "3품이하현직", "3품이하전직", "품관촌민")
sejong.poll.kr$class <- factor(sejong.poll.kr$class, levels = class.levels, labels = class.labels.kr)
region.labels.kr <- c("서울", "유후사", "경기", "평안", "황해", "충청", "강원", "함길", "경상", "전라")
sejong.poll.kr$region <- factor(sejong.poll.kr$region, levels = region.levels, labels = region.labels.kr)
vnames.kr <- c("소계", "찬반", "계급", "지역")
names(sejong.poll.kr) <- vnames.kr
kable(sejong.poll.kr[4:1])
tbl.vote <- xtabs("소계" ~ "찬반", data = sejong.poll.kr)
tbl.vote <- xtabs(소계 ~ 찬반, data = sejong.poll.kr)
ls()
tbl.vote
vote.total
vote.class.2
?format
vote.region.bureau[, !"서울"]
vote.region.bureau[, -1]
?barplot
ls()
setwd("~/Google 드라이브/Works/Class/Case_Studies_in_Stat/R.WD/Sejong/R")
load("./sejong_poll.rda")
ls()
sejong.poll
rm(list = ls())
load("./sejong_poll_kr_2.rda")
ls()
sejong.poll.kr.2
ls()
rm(list=ls())
ls()
load("./sejong_poll0401.rda")
ls()
sejong.poll.kr.officers
rm(list=ls())
load("./sejong_poll_kor.rda")
ls()
rm(list=ls())
load("./sejong_poll_kor.RData")
ls()
load("./sejong_poll0401.rda")
rm(list=ls())
load("./sejong_poll0401.rda")
ls()
rm(list=ls())
load("./sejong_poll.rda")
ls()
load("./sejong_poll_kor.rda")
ls()
rm(list=ls())
load("./sejong_poll_kk_2.rda")
load("./sejong_poll_kr_2.rda")
ls()
sejong.poll.kr.2
?function
?
?dump
(vote.class.2.df <- as.data.frame(vote.class.2))
?subset
ㅣㄴ()
ls()
load("sejong_poll_data_kr.rda")
ls()
(vote.class.2.df <- as.data.frame(vote.class.2))
vote.bureaus.df <- subset(vote.class.2.df, vote.class.2.df$class.2 == "관료")
(vote.bureaus.df <- subset(vote.class.2.df, vote.class.2.df$class.2 == "관료"))
(vote.bureaus.df <- subset(vote.class.2.df, vote.class.2.df$class.2 == "관료", select = c("vote", "Freq")))
library(grid)
library(gridExtra)
?grid.arrange
ls()
as.data.frame(vote.seoul.class)
?scale_x_discrete
library(ggplot2)
?scale_x_discrete
?guides
?legend.title
??legend.title
?scale_fill_manual
vote.seoul.df <- as.data.frame(vote.seoul.class)
b1.seoul <- ggplot(vote.seoul.df, aes(x = class, y = Freq, fill = vote)) +
geom_bar(stat = "identity", position = "dodge")
b1.seoul
b2.seoul <- b1.seoul +
theme_bw(base_family = "NanumGothic") +
theme.kr +
scale_x_discrete(name = "계급") +
scale_y_continuous(name = "집계", breaks = vote.seoul.df$Freq, labels = vote.seoul.df$Freq) +
scale_fill_manual(name = "찬반", values = rainbow(2)[2:1])
source("./theme_Nanum_kr.R")
b2.seoul <- b1.seoul +
theme_bw(base_family = "NanumGothic") +
theme.kr +
scale_x_discrete(name = "계급") +
scale_y_continuous(name = "집계", breaks = vote.seoul.df$Freq, labels = vote.seoul.df$Freq) +
scale_fill_manual(name = "찬반", values = rainbow(2)[2:1])
b2.seoul
b3.seoul <- b2.seoul +
theme_void(base_family = "NanumGothic") +
theme.kr +
geom_text(aes(y = vote.seoul.df$Freq/2), label = vote.seoul.df$Freq)
b3.seoul
?position_dodge
ls()
as.data.frame(vote.region.bureau)
names(as.data.frame(vote.region.bureau))
names(as.data.frame(vote.region.bureau))[2]
unname
?unname
??ggtitle
?position_stack
vote.seoul.df
tapply(vote.seoul.df$Freq, vote.seoul.df$class, cumsum)
vote.seoul.df$Freq
unlis(tapply(vote.seoul.df$Freq, vote.seoul.df$class, cumsum))
unlist(tapply(vote.seoul.df$Freq, vote.seoul.df$class, cumsum))
str(unlist(tapply(vote.seoul.df$Freq, vote.seoul.df$class, cumsum)))
?geom_bar
?position_fill
?geom_text
ls()
ftbl.vote.class.region
ls()
tbl.region
tbl.vote.class
prop.table(tbl.vote.class)
?mosaicplot
mosaicplot(tbl.vote.class)
mosaicplot(t(tbl.vote.class))
mosaicplot(t(tbl.vote.class.region))
ls()
mosaicplot(vote.region.bureau)
mosaicplot(t(vote.region.bureau))
mosaicplot(t(vote.region.commons))
install.packages("rsconnect")
?kable
?knitr::kable
setwd("C:/Users/coop2711/Documents/Sejong_v2/R")
dir()
dir()
a <- 1.0
b <- 1.6* a
b
a/b
makeplot_mosaic <- function(data, x, y, ...){
xvar <- deparse(substitute(x))
yvar <- deparse(substitute(y))
mydata <- data[c(xvar, yvar)];
mytable <- table(mydata);
widths <- c(0, cumsum(apply(mytable, 1, sum)));
heights <- apply(mytable, 1, function(x){c(0, cumsum(x/sum(x)))});
alldata <- data.frame();
allnames <- data.frame();
for(i in 1:nrow(mytable)){
for(j in 1:ncol(mytable)){
alldata <- rbind(alldata, c(widths[i], widths[i+1], heights[j, i], heights[j+1, i]));
}
colnames(alldata) <- c("xmin", "xmax", "ymin", "ymax")
alldata[[xvar]] <- rep(dimnames(mytable)[[1]],rep(ncol(mytable), nrow(mytable)));
alldata[[yvar]] <- rep(dimnames(mytable)[[2]],nrow(mytable));
ggplot(alldata, aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax)) +
geom_rect(color="black", aes_string(fill=yvar)) +
xlab(paste(xvar, "(count)")) + ylab(paste(yvar, "(proportion)"));
}
makeplot_mosaic(mtcars, vs gear)
?file
setwd("~/Google 드라이브/Works/Class/Case_Studies_in_Stat/R.WD/Sejong_v2/R")
load("sejong_poll_data_kr.rda")
ls()
file(sejong.poll.kr)
setwd("~/Google 드라이브/Works/Class/Case_Studies_in_Stat/R.WD/Sejong_v2/R")
ls()
rm(list = ls())
load("./sejong_poll_data.rda")
ls()
sejong.poll
sejong.poll.2
library(pander)
library(knitr)
library(ggplot2)
library(grid)
library(gridExtra)
library(extrafont)
panderOptions('table.split.table', Inf)
load("sejong_poll_data.rda")
str(sejong.poll.2)
kable(sejong.poll.2[c(4, 3, 5, 2, 1)])
kable(t(as.matrix(format(tbl.vote, big.mark = ","))), caption = "전체 찬반", align = 'c')
ls()
rm(list = ls())
load("sejong_poll_data_kr.rda")
ls()
class.labels
rm(list = ls())
load("sejong_poll_data.rda")
ls()
class.labels
class.levels
names(sejong.poll)
load("./sejong_poll_data.rda")
```
### Data
```{r, dataframe}
load("./sejong_poll_data.rda")
kable(sejong.poll[4:1])
sejong.poll.en <- sejong.poll
sejong.poll.en$vote <- factor(sejong.poll.en$vote, levels = c("yes", "no")))
sejong.poll.en$class <- factor(sejong.poll.en$class, levels = class.levels, labels = class.labels)
sejong.poll.en$vote <- factor(sejong.poll.en$vote, levels = c("yes", "no"))
sejong.poll.en$class <- factor(sejong.poll.en$class, levels = class.levels, labels = class.labels)
sejong.poll.en$region <- factor(sejong.poll.en$region, levels = region.levels, labels = region.labels)
kable(sejong.poll.en[4:1])
ls()
class.labels
class.levels
rm(list = ls())
load("./sejong_poll_data.rda")
kable(sejong.poll[4:1])
ls()
class.labels
class.levels
sejong.poll.en <- sejong.poll
sejong.poll.en$vote <- factor(sejong.poll.en$vote, levels = c("yes", "no"))
sejong.poll.en$class <- factor(sejong.poll.en$class, levels = class.levels, labels = class.labels)
sejong.poll.en$region <- factor(sejong.poll.en$region, levels = region.levels, labels = region.labels)
kable(sejong.poll.en[4:1])
tbl.vote <- xtabs(counts ~ vote, data = sejong.poll.en)
tbl.class <- xtabs(counts ~ class, data = sejong.poll.en)
tbl.region <- xtabs(counts ~ region, data = sejong.poll.en)
tbl.vote.class <- xtabs(counts ~ vote + class, data = sejong.poll.en)
tbl.vote.region <- xtabs(counts ~ vote + region, data = sejong.poll.en)
tbl.vote.class.region <- xtabs(counts ~ vote + class + region, data = sejong.poll.en)
ftbl.vote.class.region <- ftable(xtabs(counts ~ vote + class + region, data = sejong.poll.en))
sejong.poll.array <- xtabs(counts ~ vote + class + region, data = sejong.poll.en)
str(sejong.poll.array)
sejong.poll.array
vote.total <- xtabs(counts ~ vote, data = sejong.poll.en)
kable(t(as.matrix(vote.total)), caption = "Total")
kable(t(as.matrix(format(prop.table(vote.total)*100, digits = 3, nsmall = 1))), caption = "Percentage", align = rep("r", 2))
vote.total.2 <- apply(sejong.poll.array, 1, sum)
# kable(t(as.matrix(vote.total.2)))
kable(t(as.matrix(vote.total.2)), caption = "Total")
vote.class <- xtabs(counts ~ vote + class, data = sejong.poll.en)
kable(vote.class, caption = "Classwise")
vote.class.a <- apply(sejong.poll.array, 1:2, sum)
kable(vote.class.a, caption = "Classwise")
sejong.poll.en$class.2 <- factor(ifelse(sejong.poll.en$class == "Commons", "Commons", "Bureaus"), levels = c("Bureaus", "Commons"))
kable(sejong.poll.en[c(4, 3, 5, 2, 1)])
str(sejong.poll.en)
load("sejong_poll_data_en.rda")
ls()
str(sejong.poll.2)
kable(sejong.poll.2[c(4, 3, 5, 2, 1)])
kable(t(as.matrix(format(tbl.vote, big.mark = ","))), caption = "Total Pros and Cons", align = 'c')
kable(t(as.table(format(tbl.vote, big.mark = ","))), caption = "Total Pros and Cons", align = 'c')
kable(t(as.table(format(prop.table(tbl.vote)*100, digits = 3, nsmall = 1))), caption = "Total Pros and Cons(%)", align = 'c')
gray.2 <- gray.colors(12)[c(12, 7)]
rainbow.2 <- rainbow(2)[2:1]
pie(tbl.vote, col = rainbow.2)
title(main = "Total Pros and Cons")
text(x = 0, y = c(0.4, -0.4), labels = format(tbl.vote, big.mark = ","))
vote.df <- as.data.frame(tbl.vote)
# y.coord <- cumsum(vote.df$Freq)/2 + c(0, cumsum(head(vote.df$Freq, -1))/2)
y.coord <- cumsum(vote.df$Freq)/2
pie.label <- paste(levels(vote.df$vote), format(vote.df$Freq, big.mark = ","), sep = "\n")
str(vote.df)
p1 <- ggplot(vote.df, aes(x = "", y = Freq, fill = vote))
p2 <- p1 +
geom_bar(width = 1, stat = "identity")
p2
p2.2 <- p1 +
geom_bar(width = 1, stat = "identity", position = "dodge")
p2.2
p3.2 <- p2.2 +
theme_bw()
p3.2
p4.2 <- p3.2 +
theme.kr
p4.2
p4.2 <- p3.2
p4.2
p5.2 <- p4.2 +
scale_x_discrete(name = "Pros and Cons") +
scale_y_continuous(name = "Total", breaks = vote.df$Freq, labels = format(vote.df$Freq, big.mark = ","))
p5.2
p6.2 <- p5.2 +
scale_fill_manual(name = "Pros and Cons", values = rainbow(2)[2:1], labels = vote.df$vote)
p6.2
p7.2 <- p6.2 +
theme(legend.position = c(0.8, 0.85))
p7.2
p3 <- p2 +
theme_bw()
p3
p4 <- p3 +
p4 <- p3
p4
p3
p4 <- p3
p4
p5 <- p4 +
scale_x_discrete(name = "Pros and Cons") +
scale_y_continuous(name = "Total", breaks = cumsum(vote.df$Freq), labels = format(cumsum(vote.df$Freq), big.mark = ","))
p5
p6 <- p5 +
scale_fill_manual(name = "Pros and Cons", values = rainbow(2)[2:1], labels = vote.df$vote)
p6
# ggsave("../pics/sejong_geom_bar_total_ggplot_stack.png", p6, dpi = 72)
p7 <- p6 +
theme(legend.position = c(0.5, 0.25))
p7
pie.total.1 <- p2 +
coord_polar(theta = "y", start = 3*pi/2, direction = -1)
pie.total.1
pie.total.2 <- pie.total.1 +
scale_y_continuous(name = "", breaks = NULL) +
scale_x_discrete(name = "")
pie.total.2
pie.total.3 <- pie.total.2 +
scale_fill_manual(name = "", values = rainbow(2)[2:1])
pie.total.3
pie.total.4 <- pie.total.3 +
theme_void(base_family = "NanumGothic")
pie.total.4
pie.total.5 <- pie.total.4 +
guides(fill = "none")
pie.total.5
pie.total.6 <- pie.total.5 +
#  geom_text(aes(y = y.coord), label = pie.label, family = "NanumGothic")
geom_text(aes(y = y.coord), label = pie.label, family = "NanumGothic", position = position_stack())
pie.total.6
pie.total.7 <- pie.total.6 +
ggtitle("Total Pros and Cons") +
theme(plot.margin = unit(c(1, 1, 1.5, 1), "lines"))
pie.total.7
# ggsave("../pics/sejong_total_pie_ggplot.png", pie.total.7, dpi = 72)
```
#### `pie.gg()`
```{r, pie.gg, fig.width = 4, fig.height = 4}
pie.gg <- function(df, ggtitle = "", font.family = ""){
n <- length(names(df))
y.coord <- cumsum(df$Freq)
pie.label <- paste(levels(df$vote), format(df$Freq, big.mark = ","), sep = "\n")
p1 <- ggplot(df, aes(x = "", y = Freq, fill = vote))
p2 <- p1 +
geom_bar(width = 1, stat = "identity")
pie.1 <- p2 +
coord_polar(theta = "y", start = 3*pi/2, direction = -1)
pie.2 <- pie.1 +
scale_y_continuous(name = "", breaks = NULL) +
scale_x_discrete(name = "")
pie.3 <- pie.2 +
scale_fill_manual(name = "", values = rainbow(n)[n:1])
pie.4 <- pie.3 +
theme_void(base_family = font.family)
pie.5 <- pie.4 +
guides(fill = "none")
pie.6 <- pie.5 +
geom_text(aes(y = y.coord/n), label = pie.label, family = font.family, position = position_stack())
pie.7 <- pie.6 +
ggtitle(ggtitle) +
theme(plot.margin = unit(c(1, 1, 1.5, 1), "lines"))
return(pie.7)
}
dump("pie.gg", file = "./pie.gg.R")
pie.gg(vote.df, ggtitle = "Total Pros and Cons", font.family = "NanumGothic")
```
<P style = "page-break-before:always">
# Class 및 Region별 Pros and Cons
## Class별 Pros and Cons
```{r, vote by classes}
kable(format(vote.class, big.mark = ","), align = "r", caption = "Class별 Pros and Cons")
kable(format(prop.table(vote.class, margin = 2)*100, digits = 3, nsmall = 1), align = "r", caption = "Class별 Pros and Cons(%)")
source("./pie.gg.R")
pie.gg
vote.df <- as.data.frame(tbl.vote)
vote.df
y.coord <- cumsum(vote.df$Freq)/2
pie.label <- paste(levels(vote.df$vote), format(vote.df$Freq, big.mark = ","), sep = "\n")
str(vote.df)
p1 <- ggplot(vote.df, aes(x = "", y = Freq, fill = vote))
p2 <- p1 +
geom_bar(width = 1, stat = "identity")
p2
p2.2 <- p1 +
geom_bar(width = 1, stat = "identity", position = "dodge")
p2.2
p3.2 <- p2.2 +
theme_bw()
p3.2
p4.2 <- p3.2
p4.2
p5.2 <- p4.2 +
scale_x_discrete(name = "Pros and Cons") +
scale_y_continuous(name = "Total", breaks = vote.df$Freq, labels = format(vote.df$Freq, big.mark = ","))
p5.2
p6.2 <- p5.2 +
scale_fill_manual(name = "Pros and Cons", values = rainbow(2)[2:1], labels = vote.df$vote)
p6.2
p7.2 <- p6.2 +
theme(legend.position = c(0.8, 0.85))
p7.2
# ggsave("../pics/sejong_geom_bar_total_ggplot.png", p7.2, dpi = 72)
p3 <- p2 +
theme_bw()
p3
p4 <- p3
p4
p5 <- p4 +
scale_x_discrete(name = "Pros and Cons") +
scale_y_continuous(name = "Total", breaks = cumsum(vote.df$Freq), labels = format(cumsum(vote.df$Freq), big.mark = ","))
p5
p6 <- p5 +
scale_fill_manual(name = "Pros and Cons", values = rainbow(2)[2:1], labels = vote.df$vote)
p6
# ggsave("../pics/sejong_geom_bar_total_ggplot_stack.png", p6, dpi = 72)
p7 <- p6 +
theme(legend.position = c(0.5, 0.25))
p7
pie.total.1 <- p2 +
coord_polar(theta = "y", start = 3*pi/2, direction = -1)
pie.total.1
pie.total.2 <- pie.total.1 +
scale_y_continuous(name = "", breaks = NULL) +
scale_x_discrete(name = "")
pie.total.2
pie.total.3 <- pie.total.2 +
scale_fill_manual(name = "", values = rainbow(2)[2:1])
pie.total.3
pie.total.4 <- pie.total.3 +
theme_void(base_family = "NanumGothic")
pie.total.4
pie.total.5 <- pie.total.4 +
guides(fill = "none")
pie.total.5
pie.total.6 <- pie.total.5 +
#  geom_text(aes(y = y.coord), label = pie.label, family = "NanumGothic")
geom_text(aes(y = y.coord), label = pie.label, family = "NanumGothic", position = position_stack())
pie.total.6
pie.total.7 <- pie.total.6 +
ggtitle("Total Pros and Cons") +
theme(plot.margin = unit(c(1, 1, 1.5, 1), "lines"))
pie.total.7
# ggsave("../pics/sejong_total_pie_ggplot.png", pie.total.7, dpi = 72)
```
pie.bureaus <- pie.gg(vote.bureaus.df, ggtitle = "Bureaus' Pros and Cons", font.family = "NanumGothic")
pie.commons <- pie.gg(vote.commons.df, ggtitle = "Commons' Pros and Cons", font.family = "NanumGothic")
vote.class.2.df <- as.data.frame(vote.class.2)
v.names.class.en <- c("Pros.Cons", "Class", "Total")
kable(format(vote.class.2.df, big.mark = ","), align = c('c', 'c', 'r'), col.names = v.names.class.en, caption = "Bureaus and Commons")
vote.bureaus.df <- subset(vote.class.2.df, vote.class.2.df$class.2 == "Bureaus'", select = c("vote", "Freq"))
kable(format(vote.bureaus.df, big.mark = ","), align = 'r', col.names = v.names.class.en[-2], caption = "Bureaus' Pros and Cons")
vote.commons.df <- subset(vote.class.2.df, vote.class.2.df$class.2 == "Commons", select = c("vote", "Freq"))
kable(format(vote.commons.df, big.mark = ","), align = 'r', row.names = FALSE, col.names = v.names.class.en[-2], caption = "Commons' Pros and Cons")
pie.bureaus <- pie.gg(vote.bureaus.df, ggtitle = "Bureaus' Pros and Cons", font.family = "NanumGothic")
pie.commons <- pie.gg(vote.commons.df, ggtitle = "Commons' Pros and Cons", font.family = "NanumGothic")
pies.grid <- grid.arrange(pie.bureaus, pie.commons, ncol = 2, top = "")
pies.grid
# ggsave("../pics/sejong_bureaus_commons_pie_ggplot.png", pies.grid, width = 8, height = 4, dpi = 72)
pie.bureaus <- pie.gg(vote.bureaus.df, ggtitle = "Bureaus' Pros and Cons", font.family = "NanumGothic")
pie.commons <- pie.gg(vote.commons.df, ggtitle = "Commons' Pros and Cons", font.family = "NanumGothic")
pie.bureaus
pie.gg(vote.bureaus.df)
pie.gg(vote.bureaus.df, ggtitle = "", font.family = "")
pie.gg(vote.df, ggtitle = "Total Pros and Cons", font.family = "NanumGothic")
vote.bureaus.df <- subset(vote.class.2.df, vote.class.2.df$class.2 == "Bureaus'", select = c("vote", "Freq"))
kable(format(vote.bureaus.df, big.mark = ","), align = 'r', col.names = v.names.class.en[-2], caption = "Bureaus' Pros and Cons")
vote.bureaus.df
vote.class.2.df
source("./mosaic.gg.R")
mosaic_gg
m5.commons
